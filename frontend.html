<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©dex API Tester v2</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        /* --- CSS del Modal de Configuraci√≥n --- */
        .config-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); display: flex; justify-content: center;
            align-items: center; z-index: 1000;
        }
        .config-modal {
            background: white; padding: 40px; border-radius: 12px;
            max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        .config-modal h2 { margin-bottom: 30px; color: #333; }
        .config-modal input {
            width: 100%; padding: 12px; margin-bottom: 20px;
            border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;
        }
        .config-modal input:focus { outline: none; border-color: #667eea; }
        .config-modal button {
            width: 100%; padding: 12px; background: #667eea; color: white;
            border: none; border-radius: 6px; font-size: 16px; cursor: pointer;
            transition: background 0.3s;
        }
        .config-modal button:hover { background: #5568d3; }

        /* --- CSS de la App Principal --- */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 30px; background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .header h1 { color: #333; font-size: 28px; }
        .btn {
            padding: 10px 20px; border: none; border-radius: 6px;
            cursor: pointer; font-size: 14px; transition: all 0.3s;
        }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-secondary:hover { background: #d0d0d0; }
        .btn-delete { background: #DC3545; color: white; }
        .btn-delete:hover { background: #c82333; }

        /* --- CSS del Contenido (Formularios) --- */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        .form-column {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .form-column h2 {
            font-size: 18px; font-weight: 600; color: #333;
            margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e0e0e0;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block; margin-bottom: 8px;
            font-weight: 600; color: #333;
        }
        .form-group input {
            width: 100%; padding: 10px; border: 2px solid #e0e0e0;
            border-radius: 6px; font-size: 14px; font-family: inherit;
        }
        .form-group input:focus { outline: none; border-color: #667eea; }
        
        /* --- CSS del √Årea de Respuesta --- */
        #responseArea {
            margin-top: 20px; background: #222; color: #0f0;
            padding: 15px; border-radius: 8px; font-family: monospace;
            white-space: pre-wrap; word-wrap: break-word;
            min-height: 100px;
        }
        .error { background: #ffebee; color: #c62828; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    </style>
</head>
<body>
    
    <div id="configOverlay" class="config-overlay">
        <div class="config-modal">
            <h2>üéØ Configuraci√≥n de la API</h2>
            <p style="font-size: 14px; color: #666; margin-bottom: 20px;">
                Pega la URL de tu API y la API Key para conectar.
            </p>
            <input type="text" id="apiUrl" placeholder="API URL (ej: https://api.example.com/prod)">
            <input type="password" id="apiKey" placeholder="API Key">
            <button onclick="saveConfig()">Conectar</button>
        </div>
    </div>

    <div id="app" style="display: none;">
        
        <div class="header">
            <h1>Pok√©dex API Tester Desacoplada</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="logout()">‚öôÔ∏è Cambiar Configuraci√≥n</button>
            </div>
        </div>

        <div id="errorContainer"></div>
        <div id="loading" class="loading" style="display: none;">Cargando...</div>

        <div class="content-grid">
            
            <div class="form-column">
                <h2>Crear Pok√©mon (POST /pokemon)</h2>
                <form id="formCreate">
                    <div class="form-group">
                        <label>ID del Pok√©mon *</label>
                        <input type="number" id="createId" placeholder="ID (ej: 25)" required>
                    </div>
                    <div class="form-group">
                        <label>Nombre *</label>
                        <input type="text" id="createName" placeholder="Nombre (ej: Pikachu)" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo *</label>
                        <input type="text" id="createType" placeholder="Tipo (ej: El√©ctrico)" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Crear</button>
                </form>

                <h2 style="margin-top: 30px;">Obtener Todos (GET /pokemon)</h2>
                <form id="formGetAll">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Obtener Todos</button>
                </form>
            </div>

            <div class="form-column">
                <h2>Obtener Pok√©mon (GET /pokemon/{id})</h2>
                <form id="formGet">
                    <div class="form-group">
                        <label>ID del Pok√©mon *</label>
                        <input type="number" id="getId" placeholder="ID del Pok√©mon" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Obtener</button>
                </form>

                <h2 style="margin-top: 30px;">Borrar Pok√©mon (DELETE /pokemon/{id})</h2>
                <form id="formDelete">
                    <div class="form-group">
                        <label>ID del Pok√©mon a borrar *</label>
                        <input type="number" id="deleteId" placeholder="ID del Pok√©mon" required>
                    </div>
                    <button type="submit" class="btn btn-delete" style="width: 100%;">Borrar</button>
                </form>
            </div>

            <div class="form-column">
                <h2>Actualizar Pok√©mon (PUT /pokemon/{id})</h2>
                <form id="formUpdate">
                    <div class="form-group">
                        <label>ID del Pok√©mon a actualizar *</label>
                        <input type="number" id="updateId" placeholder="ID del Pok√©mon" required>
                    </div>
                    <div class="form-group">
                        <label>Nuevo Nombre (opcional)</label>
                        <input type="text" id="updateName" placeholder="Nuevo Nombre">
                    </div>
                    <div class="form-group">
                        <label>Nuevo Tipo (opcional)</label>
                        <input type="text" id="updateType" placeholder="Nuevo Tipo">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Actualizar</button>
                </form>
            </div>

            <div class="form-column">
                <h2>Respuesta de la API</h2>
                <pre id="responseArea">Esperando acci√≥n...</pre>
            </div>

        </div>
    </div>

    <script>
        let API_URL = '';
        let API_KEY = '';

        window.onload = () => {
            const savedUrl = localStorage.getItem('pokedexApiUrl');
            const savedKey = localStorage.getItem('pokedexApiKey');
            
            if (savedUrl && savedKey) {
                document.getElementById('apiUrl').value = savedUrl;
                document.getElementById('apiKey').value = savedKey;
                saveConfig();
            }
        };

        function saveConfig() {
            const url = document.getElementById('apiUrl').value.trim();
            const key = document.getElementById('apiKey').value.trim();

            if (!url || !key) {
                alert('Por favor, completa ambos campos');
                return;
            }
            
            // Asegura que la URL no tenga /pokemon al final
            API_URL = url.replace(/\/pokemon\/?$/, ''); 
            API_KEY = key;

            localStorage.setItem('pokedexApiUrl', API_URL);
            localStorage.setItem('pokedexApiKey', API_KEY);

            document.getElementById('configOverlay').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            
            // Carga los Pok√©mon en cuanto se conecta
            document.getElementById('formGetAll').dispatchEvent(new Event('submit'));
        }

        function logout() {
            if (confirm('¬øSeguro que quieres cambiar la configuraci√≥n de la API?')) {
                document.getElementById('configOverlay').style.display = 'flex';
                document.getElementById('app').style.display = 'none';
            }
        }

        // --- Funci√≥n de Petici√≥n API ---
        async function apiRequest(endpoint, method = 'GET', body = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': API_KEY
                }
            };

            if (body) {
                options.body = JSON.stringify(body);
            }

            const response = await fetch(`${API_URL}${endpoint}`, options);
            
            if (method === 'DELETE' && response.status === 204) {
                 return { message: 'Eliminado correctamente' };
            }

            const data = await response.json();

            if (!response.ok) {
                const errorMsg = data.error || data.message || `Error ${response.status}`;
                throw new Error(errorMsg);
            }

            return data;
        }

        // --- Funci√≥n de Respuesta (del Pok√©dex Tester) ---
        function showResponse(data, status = 200) {
            const responseArea = document.getElementById('responseArea');
            responseArea.style.color = (status >= 400) ? "#f00" : "#0f0";
            responseArea.textContent = `Estado: ${status}\n\n${JSON.stringify(data, null, 2)}`;
            
            // Si la respuesta es buena y no es un GET (ej: Create, Update, Delete),
            // actualiza la lista de "Obtener Todos"
            if (status < 300 && status !== 200) {
                 document.getElementById('formGetAll').dispatchEvent(new Event('submit'));
            }
        }
        
        function showError(message) {
             showResponse({ error: message }, 500);
        }

        // --- L√≥gica de Formularios (Adaptada del Pok√©dex Tester) ---

        // --- CREAR (POST) ---
        document.getElementById('formCreate').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('createId').value;
            const name = document.getElementById('createName').value;
            const type = document.getElementById('createType').value;
            
            const body = {
                pokedex_id: parseInt(id),
                name: name,
                pokemon_type: type
            };

            try {
                const data = await apiRequest('/pokemon', 'POST', body);
                showResponse(data, 201); // 201 Created
            } catch (error) {
                showError(error.message);
            }
        });

        // --- OBTENER (GET) ---
        document.getElementById('formGet').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('getId').value;
            if (!id) return;

            try {
                const data = await apiRequest(`/pokemon/${id}`, 'GET');
                showResponse(data, 200);
            } catch (error) {
                showError(error.message);
            }
        });

        // --- OBTENER TODOS (GET ALL) ---
        document.getElementById('formGetAll').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const data = await apiRequest('/pokemon', 'GET');
                showResponse(data, 200);
            } catch (error) {
                showError(error.message);
            }
        });

        // --- ACTUALIZAR (PUT) ---
        document.getElementById('formUpdate').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('updateId').value;
            if (!id) return;

            const name = document.getElementById('updateName').value;
            const type = document.getElementById('updateType').value;
            
            const body = {};
            if (name) body.name = name;
            if (type) body.pokemon_type = type;

            if (Object.keys(body).length === 0) {
                alert('Debes rellenar al menos un campo para actualizar.');
                return;
            }

            try {
                const data = await apiRequest(`/pokemon/${id}`, 'PUT', body);
                showResponse(data, 200);
            } catch (error) {
                showError(error.message);
            }
        });

        // --- BORRAR (DELETE) ---
        document.getElementById('formDelete').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('deleteId').value;
            if (!id) return;

            if (!confirm(`¬øEst√°s seguro de eliminar al Pok√©mon con ID ${id}?`)) {
                return;
            }

            try {
                const data = await apiRequest(`/pokemon/${id}`, 'DELETE');
                showResponse(data, 204); // 204 No Content
            } catch (error) {
                showError(error.message);
            }
        });
    </script>
</body>
</html>